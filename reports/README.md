# ?? PharmacyChain - Система управління мережею аптек

## ?? Опис проекту

**PharmacyChain** - це веб-додаток для управління мережею аптек, розроблений на базі ASP.NET Core 8 з базою даних SQL Server. Система підтримує управління препаратами, аптеками, клієнтами, продажами та закупівлями з повною реалізацією CRUD операцій, ролей доступу та ACID властивостей.

---

## ?? Встановлення та Запуск

### Вимоги
- **.NET 8 SDK** або новіше
- **Visual Studio 2022** або VS Code
- **SQL Server 2019** або новіше (LocalDB)

### Крок 1: Клонування проекту
```bash
git clone https://github.com/llkbb/PharmacyService.git
cd PharmacyChain
```

### Крок 2: Встановлення залежностей
```bash
dotnet restore
```

### Крок 3: Оновлення БД
```bash
# За допомогою Package Manager Console (Visual Studio)
Update-Database

# Або через CLI
dotnet ef database update
```

### Крок 4: Запуск додатку
```bash
dotnet run
```

Додаток буде доступний на: `https://localhost:7299`

---

## ?? Вхід у систему

### Тестові облікові записи

| Роль | Email | Пароль |
|------|-------|--------|
| Admin | admin@pharmacy.com | Admin123! |
| Pharmacist | pharmacist@pharmacy.com | Pharm123! |
| User | user@pharmacy.com | User123! |

---

## ?? Функціональність

### 1?? Управління препаратами
- Додавання, редагування, видалення препаратів
- Фільтрація рецептурних препаратів
- Категоризація та інформація про виробника

### 2?? Управління аптеками
- CRUD операції для аптек
- Керування адресами та контактами
- Огляд складів у кожній аптеці

### 3?? Управління складом (InventoryItems)
- Контроль залишків товарів
- Моніторинг низьких залишків
- Оновлення цін для аптек

### 4?? Управління продажами
- Створення продажів з автоматичним списанням складу
- Відслідження продажів за період
- Групування за датами з агрегацією сум

### 5?? Управління закупівлями
- Створення замовлень у постачальників
- Управління статусами замовлень
- Отримання товарів

### 6?? Управління клієнтами та рецептами
- Реєстрація клієнтів
- Ведення рецептів з датами видачі
- Контроль терміну дії

### 7?? Управління персоналом
- CRUD операції для працівників
- Призначення на аптеки
- Управління ролями

---

## ?? SQL Запити (QueriesController)

### Query 1: Рецептурні препарати (Фільтрація)
```
GET /Queries/RxDrugs
```
Повертає список препаратів, що потребують рецепта

### Query 2: Продажі за період (Агрегація)
```
POST /Queries/SalesByDate
```
Параметри: `from` (date), `to` (date)  
Повертає суму продажів по датах

### Query 3: Низькі залишки (JOIN)
```
GET /Queries/LowStock
```
Препарати де `Quantity <= ReorderLevel`

### Query 4: Оновити ціну (UPDATE)
```
POST /Queries/UpdatePrice
```
Параметри: `pharmacyId`, `drugId`, `newPrice`

### Query 5: Видалити постачальника (DELETE)
```
POST /Queries/DeleteSupplier
```
Параметр: `supplierId`  
З перевіркою пов'язаних замовлень

### Query 6: Додати продаж (INSERT + UPDATE)
```
POST /Queries/InsertSale
```
Атомарна операція: створення продажу + зменшення складу

---

## ??? Ролі та Доступ

### Admin (Адміністратор)
- ? Повний доступ до всіх функцій
- ? Управління препаратами, аптеками, клієнтами
- ? Управління складом та продажами
- ? Просмотр звітів

### Pharmacist (Фармацевт)
- ? Управління складом
- ? Створення продажів
- ? Перегляд рецептів
- ? Немає доступу до управління препаратами

### User (Користувач)
- ? Перегляд Dashboard
- ? Обмежений доступ
- ? Немає доступу до CRUD операцій

---

## ??? Архітектура БД

### Основні таблиці

```
Drugs               - Препарати
Pharmacies          - Аптеки
Customers           - Клієнти
Employees           - Працівники
Suppliers           - Постачальники
InventoryItems      - Запаси на складі
Sales               - Продажі
SaleLines           - Позиції продажу
PurchaseOrders      - Замовлення у постачальників
PurchaseOrderLines  - Позиції замовлень
Prescriptions       - Рецепти
```

### Зв'язки
- 1-to-Many: Pharmacy ? InventoryItems, Sales, Employees
- 1-to-Many: Drug ? InventoryItems, SaleLines, Prescriptions
- 1-to-Many: Customer ? Sales, Prescriptions
- Many-to-Many: (через таблиці Lines)

---

## ?? ACID Властивості

### ? Atomicity (Атомарність)
Операції продажу виконуються як одна транзакція:
```csharp
using var transaction = await _db.Database.BeginTransactionAsync();
try {
    // Усі операції разом
    await transaction.CommitAsync();
} catch {
    await transaction.RollbackAsync();
}
```

### ? Consistency (Послідовність)
- Data Annotations для валідації
- Foreign Key обмеження
- Business Logic перевірки

### ? Isolation (Ізоляція)
- SQL Server READ COMMITTED
- Окремий контекст для кожного запиту

### ? Durability (Надійність)
- Постійне зберігання в SQL Server
- Резервне копіювання

---

## ?? Технологічний стек

- **Framework**: ASP.NET Core 8
- **Database**: SQL Server 2019+
- **ORM**: Entity Framework Core
- **Frontend**: HTML5, CSS3, Bootstrap 5
- **Templating**: Razor Pages
- **Authentication**: ASP.NET Core Identity
- **Language**: C# 12

---

## ?? Структура проекту

```
PharmacyChain/
??? Controllers/
?   ??? Crud/           (11 CRUD контролерів)
?   ??? HomeController
?   ??? AccountController
?   ??? QueriesController
??? Models/             (11 моделей)
??? Views/              (50+ представлень)
??? Services/           (BusinessLogic, Inventory, Sales)
??? Data/               (DbContext, Migrations, Seeders)
??? Exceptions/         (BusinessLogicException)
??? ViewModels/         (DashboardViewModel, LoginViewModel)
??? Properties/
```

---

## ?? Тестування

### Основні тестові сценарії

1. **Логін та ролі**
   - Попробувати логін з трьома обліками
   - Перевірити видимість меню за роллю

2. **CRUD операції**
   - Додати новий препарат
   - Редагувати дані аптеки
   - Видалити клієнта без покупок
   - Спробувати видалити препарат на складі (повинна бути помилка)

3. **Продажі (Транзакції)**
   - Створити продаж
   - Перевірити, що склад зменшився
   - Видалити продаж (повернення на склад)

4. **Запити**
   - Відфільтрувати рецептурні препарати
   - Переглянути продажи за період
   - Перевірити низькі залишки
   - Оновити ціну

---

## ?? Dashboard

На головній сторінці доступна:
- ?? 4 KPI картки (Аптеки, Препарати, Клієнти, Постачальники)
- ?? Продажи за сьогодні
- ?? Кількість низьких залишків
- ?? Топ 5 найбільш продаються препаратів
- ?? Останні 5 продажів

---

## ?? Усунення неполадок

### Проблема: "Cannot open database"
**Рішення:**
```bash
# Видалити старі дані
drop database PharmacyChain

# Пересоздати
Update-Database
```

### Проблема: "404 Not Found" на кнопках
**Рішення:** Переконайтесь, що маршрути використовують `asp-controller` та `asp-action`

### Проблема: "Unauthorized"
**Рішення:** Перевірте роль облікового запису та авторизацію в контролері

---

## ?? Ліцензія

MIT License - вільне використання в освітніх цілях

---

## ????? Автор

Розроблено як частина навчального курсу з ООП

---

## ? Чеклист функціональності

- [x] CRUD для 11 сутностей
- [x] 3 ролі доступу
- [x] 6 SQL запитів різних типів
- [x] ACID транзакції
- [x] Dashboard з статистикою
- [x] Бізнес-логіка и валідація
- [x] Автентифікація та авторизація
- [x] Bootstrap дизайн
- [x] Українська мова

---

**Проект готовий до використання! ??**

