@model IEnumerable<PharmacyChain.Models.Prescription>

@{
    ViewData["Title"] = "Мої рецепти";
}

<div class="container mt-4">
    <h2><i class="bi bi-file-medical"></i> Мої рецепти</h2>
    <p class="lead">Привіт, @ViewBag.CustomerName!</p>

    <div class="mb-3">
        <a asp-action="UploadPrescription" class="btn btn-primary">
            <i class="bi bi-upload"></i> Завантажити новий рецепт
        </a>
    </div>

    @if (!Model.Any())
    {
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> У вас поки немає рецептів.
            <a asp-action="UploadPrescription" class="alert-link">Завантажити рецепт</a>
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Препарат</th>
                        <th>Лікар</th>
                        <th>Дата завантаження</th>
                        <th>Статус</th>
                        <th>Фото</th>
                        <th>Примітки</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var prescription in Model)
                    {
                        var statusClass = prescription.Status switch
                        {
                            "Approved" => "success",
                            "Rejected" => "danger",
                            _ => "warning"
                        };
                        var statusText = prescription.Status switch
                        {
                            "Approved" => "Затверджено",
                            "Rejected" => "Відхилено",
                            _ => "Очікує перевірки"
                        };

                        <tr>
                            <td>@prescription.Id</td>
                            <td>
                                @if (prescription.Drug != null)
                                {
                                    <strong>@prescription.Drug.Name</strong>
                                }
                                else
                                {
                                    <span class="text-muted">Не вказано</span>
                                }
                            </td>
                            <td>@prescription.DoctorName</td>
                            <td>@prescription.CreatedAt.ToString("dd.MM.yyyy HH:mm")</td>
                            <td>
                                <span class="badge bg-@statusClass">@statusText</span>
                                @if (prescription.Status == "Approved")
                                {
                                    <br />
                                    <small class="text-muted">
                                        Дійсний до: @prescription.DateIssued.AddDays(prescription.ValidDays).ToString("dd.MM.yyyy")
                                    </small>
                                }
                                @if (prescription.Status == "Rejected" && !string.IsNullOrEmpty(prescription.RejectionReason))
                                {
                                    <br />
                                    <small class="text-danger">Причина: @prescription.RejectionReason</small>
                                }
                            </td>
                            <td>
                                @if (!string.IsNullOrEmpty(prescription.PhotoPath))
                                {
                                    <a href="@prescription.PhotoPath" target="_blank" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-image"></i> Переглянути
                                    </a>
                                }
                                else
                                {
                                    <span class="text-muted">Немає фото</span>
                                }
                            </td>
                            <td>
                                @if (!string.IsNullOrEmpty(prescription.Notes))
                                {
                                    <small>@prescription.Notes</small>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }

    <a asp-action="Index" class="btn btn-secondary mt-3">
        <i class="bi bi-arrow-left"></i> До каталогу
    </a>
</div>
