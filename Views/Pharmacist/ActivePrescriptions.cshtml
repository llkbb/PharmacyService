@model IEnumerable<PharmacyChain.Models.Prescription>

@{
    ViewData["Title"] = "Активні рецепти";
}

<div class="container mt-4">
    <h2><i class="bi bi-file-medical"></i> Активні рецепти</h2>
    <p class="text-muted">Дійсні рецепти, за якими можна видати препарати</p>

    @if (!Model.Any())
    {
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> Немає активних рецептів
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-info">
                    <tr>
                        <th>№ Рецепту</th>
                        <th>Клієнт</th>
                        <th>Препарат</th>
                        <th>Лікар</th>
                        <th>Аптека</th>
                        <th>Видано</th>
                        <th>Дійсний до</th>
                        <th>Статус</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var prescription in Model)
                    {
                        var expiryDate = prescription.DateIssued.AddDays(prescription.ValidDays);
                        var daysLeft = (expiryDate - DateTime.UtcNow).Days;
                        var isExpiringSoon = daysLeft <= 3;
                        
                        <tr class="@(isExpiringSoon ? "table-warning" : "")">
                            <td><strong>#@prescription.Id</strong></td>
                            <td>
                                @prescription.Customer.FullName
                                <br />
                                <small class="text-muted">@prescription.Customer.Phone</small>
                            </td>
                            <td>
                                <strong>@prescription.Drug.Name</strong>
                                <br />
                                <small class="text-muted">@prescription.Drug.Category</small>
                                <span class="badge bg-danger">Rx</span>
                            </td>
                            <td>@prescription.DoctorName</td>
                            <td>@prescription.Pharmacy.Name</td>
                            <td>@prescription.DateIssued.ToString("dd.MM.yyyy")</td>
                            <td>
                                @expiryDate.ToString("dd.MM.yyyy")
                                @if (isExpiringSoon)
                                {
                                    <br />
                                    <small class="text-warning">
                                        <i class="bi bi-clock"></i> Залишилось @daysLeft дн.
                                    </small>
                                }
                            </td>
                            <td>
                                @if (isExpiringSoon)
                                {
                                    <span class="badge bg-warning text-dark">Скоро закінчиться</span>
                                }
                                else
                                {
                                    <span class="badge bg-success">Дійсний</span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="alert alert-warning mt-3">
            <h6><i class="bi bi-exclamation-triangle"></i> Важливо при видачі препаратів:</h6>
            <ul class="mb-0">
                <li>Перевіряйте термін дії рецепту</li>
                <li>Переконайтеся, що клієнт - той же, що вказаний у рецепті</li>
                <li>Рецептурні препарати (Rx) видаються ТІЛЬКИ за рецептом</li>
                <li>При сумнівах зв'яжіться з лікарем, що виписав рецепт</li>
            </ul>
        </div>
    }

    <div class="mt-3">
        <a href="@Url.Action("Index")" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Назад до Dashboard
        </a>
        <a href="@Url.Action("Index", "Prescriptions")" class="btn btn-info">
            <i class="bi bi-list"></i> Всі рецепти
        </a>
    </div>
</div>
